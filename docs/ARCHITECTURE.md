# Architecture Overview

Diagram dan penjelasan cara kerja aplikasi secara menyeluruh.

---

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLOUDFLARE EDGE                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Tokyo Edge    â”‚  â”‚  London Edge    â”‚  â”‚  SÃ£o Paulo Edge â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚
â”‚  â”‚  â”‚  Worker   â”‚  â”‚  â”‚  â”‚  Worker   â”‚  â”‚  â”‚  â”‚  Worker   â”‚  â”‚              â”‚
â”‚  â”‚  â”‚  (SSR)    â”‚  â”‚  â”‚  â”‚  (SSR)    â”‚  â”‚  â”‚  â”‚  (SSR)    â”‚  â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚              â”‚
â”‚  â”‚        â”‚        â”‚  â”‚        â”‚        â”‚  â”‚        â”‚        â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚              â”‚
â”‚  â”‚  â”‚    D1     â”‚  â”‚  â”‚  â”‚    D1     â”‚  â”‚  â”‚  â”‚    D1     â”‚  â”‚              â”‚
â”‚  â”‚  â”‚ (SQLite)  â”‚  â”‚  â”‚  â”‚ (SQLite)  â”‚  â”‚  â”‚  â”‚ (SQLite)  â”‚  â”‚              â”‚
â”‚  â”‚  â”‚  Replica  â”‚  â”‚  â”‚  â”‚  Replica  â”‚  â”‚  â”‚  â”‚  Replica  â”‚  â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ HTTPS
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER BROWSER                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         SvelteKit App                                â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  Pages   â”‚  â”‚  Forms   â”‚  â”‚   API    â”‚  â”‚   Client State   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚(Routes)  â”‚  â”‚(Actions) â”‚  â”‚ (Loads)  â”‚  â”‚   (Stores)       â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Request Flow Diagram

### 1. Page Load (Server-Side Rendering)

```
User Request (e.g., /dashboard)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare Edge â”‚
â”‚     Worker      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SvelteKit       â”‚
â”‚ hooks.server.ts â”‚
â”‚ - Inject DB     â”‚
â”‚ - Validate Auth â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ +page.server.ts â”‚
â”‚ - load()        â”‚
â”‚ - Query D1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SvelteKit       â”‚
â”‚ Render HTML     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send to Browser â”‚
â”‚ (Complete HTML) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Form Submission (Form Actions)

```
User Submit Form
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /action    â”‚
â”‚ (No JS needed)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare Edge â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ +page.server.ts â”‚
â”‚ - actions {}    â”‚
â”‚ - Validate      â”‚
â”‚ - Insert D1     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redirect/Result â”‚
â”‚ (Full page or   â”‚
â”‚  JSON response) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Client-Side API Call

```
JS Fetch API
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ +server.ts      â”‚
â”‚ (API Endpoint)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Process Request â”‚
â”‚ - Auth check    â”‚
â”‚ - DB query      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JSON Response   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ Project Structure

```
sveltekit-cf-starter/
â”‚
â”œâ”€â”€ ğŸ“ .svelte-kit/           # Generated files (auto-generated)
â”œâ”€â”€ ğŸ“ .wrangler/             # Local D1 database (SQLite)
â”‚   â””â”€â”€ state/v3/d1/
â”‚
â”œâ”€â”€ ğŸ“ drizzle/               # Database migrations
â”‚   â”œâ”€â”€ 0000_initial.sql      # Initial schema
â”‚   â”œâ”€â”€ 0001_auth.sql         # Auth tables
â”‚   â””â”€â”€ 0002_add_user_profile_fields.sql
â”‚
â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ lib/               # Shared code
â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/          # Authentication logic
â”‚   â”‚   â”‚   â”œâ”€â”€ lucia.ts      # Lucia auth config
â”‚   â”‚   â”‚   â”œâ”€â”€ google.ts     # Google OAuth setup
â”‚   â”‚   â”‚   â””â”€â”€ password.ts   # Password hashing
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ db/            # Database layer
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts     # Drizzle schema definition
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts      # DB client factory
â”‚   â”‚   â”‚   â””â”€â”€ types.ts      # TypeScript types
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ email/         # Email service
â”‚   â”‚   â”‚   â”œâ”€â”€ resend.ts     # Resend client
â”‚   â”‚   â”‚   â””â”€â”€ templates/    # Email templates
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ storage/       # File storage (R2)
â”‚   â”‚       â””â”€â”€ r2.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ routes/            # SvelteKit routes (file-based)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ +layout.svelte # Root layout (navigation)
â”‚   â”‚   â”œâ”€â”€ ğŸ“ +page.svelte   # Home page
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/           # API endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ profile/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ +server.ts    # GET/PUT profile
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ users/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ +server.ts    # GET users list
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ upload/
â”‚   â”‚   â”‚       â””â”€â”€ +server.ts    # File upload
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/          # Authentication routes
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ login/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ +server.ts    # POST login
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ register/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ +server.ts    # POST register
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ logout/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ +server.ts
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ google/
â”‚   â”‚   â”‚       â”œâ”€â”€ +server.ts    # OAuth init
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“ callback/
â”‚   â”‚   â”‚           â””â”€â”€ +server.ts # OAuth callback
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ +page.svelte      # Dashboard UI
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ profile/
â”‚   â”‚   â”‚   â””â”€â”€ +page.svelte      # Profile UI
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ login/
â”‚   â”‚   â”‚   â””â”€â”€ +page.svelte      # Login UI
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ register/
â”‚   â”‚       â””â”€â”€ +page.svelte      # Register UI
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ app.css            # Global styles
â”‚   â”œâ”€â”€ ğŸ“ app.html           # HTML template
â”‚   â”œâ”€â”€ ğŸ“ app.d.ts           # Type declarations
â”‚   â””â”€â”€ ğŸ“ hooks.server.ts    # Server hooks (auth + db)
â”‚
â”œâ”€â”€ ğŸ“ static/                # Static assets (images, fonts)
â”œâ”€â”€ ğŸ“ docs/                  # Documentation
â”‚
â”œâ”€â”€ .env                      # Environment variables (gitignored)
â”œâ”€â”€ .env.example              # Template
â”œâ”€â”€ drizzle.config.ts         # Drizzle CLI config
â”œâ”€â”€ svelte.config.js          # SvelteKit config
â”œâ”€â”€ src/app.css               # Tailwind 4 config (@theme)
â”œâ”€â”€ vite.config.ts            # Vite config
â””â”€â”€ wrangler.toml             # Cloudflare config
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     REGISTRATION FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User                    Frontend                  Backend                    D1
  â”‚                         â”‚                         â”‚                       â”‚
  â”‚ Fill form               â”‚                         â”‚                       â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚                       â”‚
  â”‚                         â”‚ POST /auth/register     â”‚                       â”‚
  â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
  â”‚                         â”‚                         â”‚ Validate input        â”‚
  â”‚                         â”‚                         â”‚ Hash password         â”‚
  â”‚                         â”‚                         â”‚ Insert user           â”‚
  â”‚                         â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                         â”‚                         â”‚                       â”‚
  â”‚                         â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                         â”‚                         â”‚ Create session        â”‚
  â”‚                         â”‚                         â”‚ Set cookie            â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
  â”‚                         â”‚ Set cookie              â”‚                       â”‚
  â”‚ Redirect to dashboard   â”‚                         â”‚                       â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                       â”‚
  â”‚                         â”‚                         â”‚                       â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LOGIN FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User                    Frontend                  Backend                    D1
  â”‚                         â”‚                         â”‚                       â”‚
  â”‚ Credentials             â”‚                         â”‚                       â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚                       â”‚
  â”‚                         â”‚ POST /auth/login        â”‚                       â”‚
  â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
  â”‚                         â”‚                         â”‚ Find user by email    â”‚
  â”‚                         â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                         â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                         â”‚                         â”‚ Verify password       â”‚
  â”‚                         â”‚                         â”‚ Create session        â”‚
  â”‚                         â”‚                         â”‚ Set cookie            â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
  â”‚                         â”‚ Set cookie              â”‚                       â”‚
  â”‚ Redirect to dashboard   â”‚                         â”‚                       â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                       â”‚
  â”‚                         â”‚                         â”‚                       â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GOOGLE OAUTH FLOW                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User                    Frontend                  Backend                    Google
  â”‚                         â”‚                         â”‚                        â”‚
  â”‚ Click "Login with       â”‚                         â”‚                        â”‚
  â”‚  Google"                â”‚                         â”‚                        â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚                        â”‚
  â”‚                         â”‚ GET /auth/google        â”‚                        â”‚
  â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
  â”‚                         â”‚                         â”‚ Generate state         â”‚
  â”‚                         â”‚                         â”‚ Redirect to Google     â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
  â”‚                         â”‚ 302 Redirect            â”‚                        â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                        â”‚
  â”‚ Login to Google         â”‚                         â”‚                        â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                         â”‚                         â”‚                        â”‚
  â”‚                         â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                         â”‚                         â”‚ Callback with code     â”‚
  â”‚                         â”‚ GET /auth/google/       â”‚                        â”‚
  â”‚                         â”‚     callback            â”‚                        â”‚
  â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
  â”‚                         â”‚                         â”‚ Exchange code          â”‚
  â”‚                         â”‚                         â”‚ Get user info          â”‚
  â”‚                         â”‚                         â”‚ Create/update user     â”‚
  â”‚                         â”‚                         â”‚ Create session         â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
  â”‚ Redirect to dashboard   â”‚                         â”‚                        â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                        â”‚
  â”‚                         â”‚                         â”‚                        â”‚
```

---

## ğŸ’¾ Data Flow Patterns

### Pattern 1: Server Load (Recommended)

```typescript
// +page.server.ts
export const load = async ({ locals }) => {
  // âœ… Query di server, data di-embed di HTML
  const users = await locals.db.query.users.findMany();
  return { users };
};

// +page.svelte
<script>
  let { data } = $props(); // Data sudah ada, no loading state!
</script>

{#each data.users as user}
  <UserCard {user} />
{/each}
```

**Flow:**
```
Request â†’ Server Query â†’ Render HTML â†’ Browser (data langsung ada)
```

### Pattern 2: Form Actions (Recommended)

```typescript
// +page.server.ts
export const actions = {
  createPost: async ({ request, locals }) => {
    const form = await request.formData();
    // âœ… Works tanpa JavaScript!
    await locals.db.insert(posts).values({ ... });
    return { success: true };
  }
};

// +page.svelte
<form method="POST" action="?/createPost">
  <input name="title" />
  <button type="submit">Create</button>
</form>
```

**Flow:**
```
Form Submit â†’ Server Action â†’ DB Insert â†’ Redirect/Result
```

### Pattern 3: Client Fetch (Use Sparingly)

```typescript
// +page.svelte
<script>
  import { onMount } from 'svelte';
  
  let users = [];
  
  onMount(async () => {
    // âš ï¸ Extra API call, loading state needed
    const res = await fetch('/api/users');
    users = await res.json();
  });
</script>

{#if users.length}
  {#each users as user}
    <UserCard {user} />
  {/each}
{:else}
  <LoadingSpinner />
{/if}
```

**Flow:**
```
Page Load â†’ HTML Render â†’ JS Fetch â†’ Loading State â†’ Display Data
```

---

## ğŸ—„ï¸ Database Schema Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users      â”‚       â”‚    sessions     â”‚       â”‚  posts          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ user_id (FK)    â”‚       â”‚ id (PK)         â”‚
â”‚ email (unique)  â”‚       â”‚ id (PK)         â”‚       â”‚ title           â”‚
â”‚ name            â”‚       â”‚ expires_at      â”‚       â”‚ content         â”‚
â”‚ bio             â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ published       â”‚
â”‚ location        â”‚                                 â”‚ author_id (FK)  â”‚â”€â”€â”
â”‚ website         â”‚                                 â”‚ created_at      â”‚  â”‚
â”‚ password_hash   â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ provider        â”‚                                                    â”‚
â”‚ google_id       â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ avatar          â”‚       â”‚ password_reset_tokens   â”‚                   â”‚
â”‚ email_verified  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚ created_at      â”‚       â”‚ id (PK)                 â”‚                   â”‚
â”‚ updated_at      â”‚       â”‚ user_id (FK)            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ token_hash              â”‚
                          â”‚ expires_at              â”‚
                          â”‚ used                    â”‚
                          â”‚ created_at              â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ email_verification_tokens   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                     â”‚
â”‚ user_id (FK)                â”‚
â”‚ token_hash                  â”‚
â”‚ expires_at                  â”‚
â”‚ used                        â”‚
â”‚ created_at                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Component Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        +layout.svelte                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Navigation Bar                       â”‚   â”‚
â”‚  â”‚  - Logo                                                  â”‚   â”‚
â”‚  â”‚  - User Menu (dari $page.data.user)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      <slot />                            â”‚   â”‚
â”‚  â”‚                      (Page Content)                      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚              +page.server.ts                      â”‚  â”‚   â”‚
â”‚  â”‚   â”‚  - load() â†’ Query DB â†’ Return data                â”‚  â”‚   â”‚
â”‚  â”‚   â”‚  - actions â†’ Handle form submission               â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                           â”‚                            â”‚   â”‚
â”‚  â”‚                           â–¼                            â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚              +page.svelte                         â”‚  â”‚   â”‚
â”‚  â”‚   â”‚  - Receive data from load()                       â”‚  â”‚   â”‚
â”‚  â”‚   â”‚  - Render UI                                      â”‚  â”‚   â”‚
â”‚  â”‚   â”‚  - Call API endpoints for client-side actions     â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Data Flow:
1. Server: hooks.server.ts â†’ inject DB + Auth
2. Server: +page.server.ts load() â†’ query DB
3. Server: Render HTML with data
4. Browser: Hydrate â†’ Interactive
5. Browser: API calls â†’ +server.ts endpoints
```

---

## ğŸš€ Deployment Architecture

```
Development                          Production
    â”‚                                    â”‚
    â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Local D1     â”‚               â”‚ Cloudflare D1    â”‚
â”‚ (SQLite file)â”‚               â”‚ (Edge replicas)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                â”‚
       â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ npm run dev  â”‚               â”‚ Cloudflare Pages â”‚
â”‚ Vite dev     â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ + Edge Functions â”‚
â”‚ server       â”‚     Deploy    â”‚ (SvelteKit SSR)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚   Global CDN     â”‚
                               â”‚  (300+ edges)    â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Performance Characteristics

| Aspect | Local Dev | Production | Notes |
|--------|-----------|------------|-------|
| **Latency** | ~10-50ms | ~50-200ms | Depends on user location |
| **Cold Start** | Instant | <50ms | Edge functions warm |
| **Database** | SQLite file | Replicated SQLite | Read: fast, Write: eventual |
| **SSR Time** | ~10ms | ~5-20ms | Edge compute is fast |
| **Bundle Size** | N/A (dev) | ~50-100KB | Code-split per route |

---

## ğŸ¯ Scalability Limits

| Resource | Free Tier | Paid Tier | When to Scale |
|----------|-----------|-----------|---------------|
| **D1 Storage** | 500MB | $0.75/GB-month | > 400MB data |
| **D1 Reads** | 5M/day | Unlimited | > 4M queries/day |
| **D1 Writes** | 100K/day | Unlimited | > 80K writes/day |
| **Workers** | 100K/day | $0.50/M | > 90K requests/day |
| **Build Time** | - | - | > 100 pages â†’ ISR |

**When to Consider Migration:**
- Database > 5GB â†’ PostgreSQL (Neon, Supabase)
- Complex queries â†’ Add caching layer
- Real-time needs â†’ WebSockets + Durable Objects

---

## ğŸ“š Next Steps

- [Setup Guide](setup/quick-start.md) - Start building
- [Authentication Guide](../guides/authentication.md) - Auth implementation
- [Security](security.md) - Harden production
- [Wrangler Commands](../wrangler-commands.md) - CLI reference
